<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexo - Plataforma Financiera</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --color-primary: #254D32;      /* Verde bosque */
      --color-background: #F5F0E7;   /* Hueso claro */
      --color-success: #4CAF50;      /* Verde éxito */
      --color-danger: #E57373;       /* Rojo alerta */
      --color-info: #2196F3;         /* Azul proyección */
      --color-white: #ffffff;
      --color-gray-light: #f8f9fa;
      --color-gray-medium: #6c757d;
      --color-gray-dark: #343a40;
      --color-text: #254D32;
      --color-text-light: #6c757d;
      
      --font-heading: 'Montserrat', sans-serif;
      --font-body: 'Inter', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background-color: var(--color-background);
      color: var(--color-text);
      line-height: 1.6;
    }

    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* Auth Styles */
    .auth-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      width: 100vw;
      background: linear-gradient(135deg, var(--color-primary) 0%, #1a3d26 100%);
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
    }

    .auth-card {
      background: var(--color-white);
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
    }

    .auth-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-header h1 {
      font-family: var(--font-heading);
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--color-primary);
    }

    .auth-header p {
      color: var(--color-text-light);
      font-size: 16px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--color-primary);
    }

    .input-with-icon {
      position: relative;
      display: flex;
      align-items: center;
    }

    .input-with-icon .material-icons {
      position: absolute;
      left: 12px;
      color: var(--color-text-light);
      font-size: 20px;
    }

    .input-with-icon input,
    .input-with-icon select {
      width: 100%;
      padding: 12px 12px 12px 44px;
      border: 2px solid rgba(37, 77, 50, 0.2);
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
      font-family: var(--font-body);
    }

    .input-with-icon input:focus,
    .input-with-icon select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(37, 77, 50, 0.1);
    }

    .form-tip {
      margin-top: 6px;
      font-size: 14px;
      color: var(--color-text-light);
    }

    .form-error {
      color: var(--color-danger);
      font-size: 14px;
      margin-bottom: 16px;
      display: none;
    }

    .auth-links {
      text-align: center;
      margin-top: 24px;
    }

    .auth-links p {
      margin: 8px 0;
      color: var(--color-text-light);
    }

    .auth-links a {
      color: var(--color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    .auth-links a:hover {
      text-decoration: underline;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, var(--color-primary) 0%, #1a3d26 100%);
      color: white;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      font-family: var(--font-heading);
      font-size: 28px;
      font-weight: 700;
      color: white;
      text-align: center;
    }

    .sidebar-user {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-name {
      font-weight: 500;
      font-size: 14px;
    }

    .sidebar-menu {
      flex: 1;
      padding: 16px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .menu-item.active {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border-right: 3px solid var(--color-success);
    }

    .sidebar-footer {
      padding: 16px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Security Badge */
    .security-badge {
      padding: 8px 16px;
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid var(--color-success);
      border-radius: 6px;
      margin: 12px 24px;
      font-size: 12px;
      color: var(--color-success);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Mobile Header */
    .mobile-header {
      display: none;
      background: var(--color-white);
      height: 60px;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 1px 3px rgba(37, 77, 50, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1001;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 40px;
      min-height: 100vh;
    }

    /* Dashboard Styles */
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .dashboard-header h1 {
      font-family: var(--font-heading);
      font-size: 32px;
      font-weight: 700;
      color: var(--color-primary);
    }

    .greeting {
      color: var(--color-text-light);
      font-size: 16px;
      margin-bottom: 8px;
    }

    /* Welcome Card */
    .welcome-card {
      background: linear-gradient(135deg, var(--color-primary) 0%, #1a3d26 100%);
      color: white;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: 0 8px 32px rgba(37, 77, 50, 0.2);
    }

    .welcome-card h2 {
      font-family: var(--font-heading);
      font-size: 24px;
      margin-bottom: 16px;
      color: white;
    }

    .setup-steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .setup-step {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: transform 0.2s;
    }

    .setup-step:hover {
      transform: translateY(-2px);
    }

    .setup-step .material-icons {
      font-size: 32px;
      margin-bottom: 12px;
      color: #fbbf24;
    }

    .setup-step h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .summary-card {
      background: var(--color-white);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(37, 77, 50, 0.1);
      border: 1px solid rgba(37, 77, 50, 0.1);
      transition: transform 0.2s;
    }

    .summary-card:hover {
      transform: translateY(-2px);
    }

    .card-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--color-text-light);
      margin-bottom: 8px;
    }

    .card-value {
      font-family: var(--font-heading);
      font-size: 32px;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 12px;
    }

    .card-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .card-indicator.positive {
      color: var(--color-success);
      background: rgba(76, 175, 80, 0.1);
    }

    .card-indicator.negative {
      color: var(--color-danger);
      background: rgba(229, 115, 115, 0.1);
    }

    .card-indicator.neutral {
      color: var(--color-text-light);
      background: rgba(108, 117, 125, 0.1);
    }

    /* Cards */
    .card {
      background: var(--color-white);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(37, 77, 50, 0.1);
      border: 1px solid rgba(37, 77, 50, 0.1);
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-header h2 {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      color: var(--color-primary);
    }

    /* Insights Cards */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .insight-card {
      background: var(--color-white);
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid var(--color-info);
      box-shadow: 0 2px 8px rgba(37, 77, 50, 0.1);
    }

    .insight-card.success {
      border-left-color: var(--color-success);
    }

    .insight-card.warning {
      border-left-color: #fbbf24;
    }

    .insight-card.danger {
      border-left-color: var(--color-danger);
    }

    .insight-content {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .insight-icon {
      color: var(--color-info);
      font-size: 20px;
    }

    .insight-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
    }

    .insight-action {
      font-weight: 600;
      color: var(--color-primary);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--color-text-light);
    }

    .empty-state .material-icons {
      font-size: 64px;
      color: #cbd5e1;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--color-primary);
    }

    .empty-state p {
      margin-bottom: 24px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Chart Container */
    .chart-container {
      height: 300px;
      margin-bottom: 16px;
    }

    .chart-placeholder {
      height: 100%;
      background: var(--color-gray-light);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-light);
      font-style: italic;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      justify-content: center;
      font-family: var(--font-body);
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: #1a3d26;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 77, 50, 0.3);
    }

    .btn-secondary {
      background: var(--color-gray-light);
      color: var(--color-text);
      border: 1px solid rgba(37, 77, 50, 0.2);
    }

    .btn-secondary:hover {
      background: #e9ecef;
    }

    .btn-success {
      background: var(--color-success);
      color: white;
    }

    .btn-danger {
      background: var(--color-danger);
      color: white;
    }

    .full-width {
      width: 100%;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: var(--color-white);
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 1px solid rgba(37, 77, 50, 0.1);
    }

    .modal-header h2 {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      color: var(--color-primary);
    }

    .close-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      color: var(--color-text-light);
    }

    .close-btn:hover {
      background: var(--color-gray-light);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 24px;
      border-top: 1px solid rgba(37, 77, 50, 0.1);
    }

    .currency-symbol {
      position: absolute;
      left: 12px;
      color: var(--color-primary);
      font-weight: 600;
    }

    /* Transaction Type Selector */
    .type-selector {
      display: flex;
      gap: 12px;
    }

    .type-option {
      flex: 1;
      cursor: pointer;
    }

    .type-option input[type="radio"] {
      display: none;
    }

    .type-label {
      display: block;
      padding: 16px;
      border: 2px solid rgba(37, 77, 50, 0.2);
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      transition: all 0.2s;
    }

    .type-option input[type="radio"]:checked + .type-label.income {
      border-color: var(--color-success);
      background: rgba(76, 175, 80, 0.1);
      color: var(--color-success);
    }

    .type-option input[type="radio"]:checked + .type-label.expense {
      border-color: var(--color-danger);
      background: rgba(229, 115, 115, 0.1);
      color: var(--color-danger);
    }

    /* WhatsApp Integration */
    .whatsapp-card {
      background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
      color: white;
      margin-bottom: 32px;
    }

    .whatsapp-card h2 {
      color: white;
    }

    .whatsapp-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .whatsapp-feature {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    .whatsapp-feature .material-icons {
      font-size: 24px;
      margin-bottom: 8px;
    }

    /* WhatsApp Demo Styles */
    .whatsapp-demo {
      background: #f8f9fa;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      margin: 0 auto;
    }

    .whatsapp-header {
      background: #075e54;
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .whatsapp-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #25d366;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
    }

    .whatsapp-messages {
      padding: 16px;
      height: 300px;
      overflow-y: auto;
      background: #e5ddd5;
    }

    .message {
      margin-bottom: 12px;
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.4;
    }

    .message.sent {
      background: #dcf8c6;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .message.received {
      background: white;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }

    .message-time {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
      text-align: right;
    }

    .whatsapp-input {
      display: flex;
      padding: 12px;
      background: #f0f0f0;
      border-top: 1px solid #ddd;
    }

    .whatsapp-input input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 20px;
      margin-right: 8px;
    }

    .whatsapp-input button {
      padding: 8px 16px;
      background: #25d366;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }

    /* Table Styles */
    .transactions-table {
      width: 100%;
    }

    .table-header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 100px;
      gap: 16px;
      padding: 16px;
      background: var(--color-gray-light);
      border-radius: 8px;
      margin-bottom: 16px;
      font-weight: 600;
    }

    .transaction-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 100px;
      gap: 16px;
      padding: 16px;
      border-bottom: 1px solid rgba(37, 77, 50, 0.1);
      align-items: center;
    }

    .source-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .mobile-header {
        display: flex;
      }

      .main-content {
        margin-left: 0;
        margin-top: 60px;
        padding: 20px;
      }

      .dashboard-header {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }

      .summary-cards {
        grid-template-columns: 1fr;
      }

      .setup-steps {
        grid-template-columns: 1fr;
      }

      .insights-grid {
        grid-template-columns: 1fr;
      }

      .table-header,
      .transaction-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Páginas de autenticación -->
    <div id="login-page" style="display: none;">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h1>Iniciar Sesión</h1>
            <p>Accede a tu cuenta de Nexo</p>
          </div>
          
          <div class="auth-form">
            <div class="form-group">
              <label for="login-phone">Teléfono o Email</label>
              <div class="input-with-icon">
                <span class="material-icons">phone</span>
                <input type="tel" id="login-phone" placeholder="demo@nexo.com" value="demo">
              </div>
              <p class="form-tip">Demo: "demo"/"demo" o Admin: "admin"/"admin"</p>
            </div>
            
            <div class="form-group">
              <label for="login-password">Contraseña</label>
              <div class="input-with-icon">
                <span class="material-icons">lock</span>
                <input type="password" id="login-password" value="demo">
              </div>
            </div>
            
            <div class="form-error" id="login-error"></div>
            
            <button class="btn btn-primary full-width" onclick="login()">Iniciar Sesión</button>
            
            <div class="auth-links">
              <p>¿No tienes cuenta? <a href="#" onclick="showRegister()">Regístrate</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="register-page" style="display: none;">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h1>Registro</h1>
            <p>Crea tu cuenta en Nexo</p>
          </div>
          
          <div class="auth-form">
            <div class="form-group">
              <label for="register-business">Nombre del Negocio</label>
              <div class="input-with-icon">
                <span class="material-icons">business</span>
                <input type="text" id="register-business" placeholder="Mi Negocio">
              </div>
            </div>
            
            <div class="form-group">
              <label for="register-industry">Industria</label>
              <div class="input-with-icon">
                <span class="material-icons">category</span>
                <select id="register-industry">
                  <option value="">Selecciona una industria</option>
                  <option value="retail">Comercio al Menudo</option>
                  <option value="professional">Servicios Profesionales</option>
                  <option value="restaurant">Restaurantes</option>
                  <option value="technical">Servicios Técnicos</option>
                  <option value="direct-sales">Venta Directa</option>
                </select>
              </div>
              <p class="form-tip">
                Con base en la industria que elijas, Nexo te preconfigura categorías comunes para tu negocio.
              </p>
            </div>

            <div class="form-group">
              <label for="register-type">Tipo de Cuenta</label>
              <div class="input-with-icon">
                <span class="material-icons">person</span>
                <select id="register-type">
                  <option value="business">Negocio</option>
                  <option value="personal">Personal</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="register-phone">Teléfono</label>
              <div class="input-with-icon">
                <span class="material-icons">phone</span>
                <input type="tel" id="register-phone" placeholder="+507 1234-5678">
              </div>
              <p class="form-tip">Se enviará un código de verificación vía SMS/WhatsApp</p>
            </div>
            
            <div class="form-group">
              <label for="register-password">Contraseña</label>
              <div class="input-with-icon">
                <span class="material-icons">lock</span>
                <input type="password" id="register-password">
              </div>
            </div>

            <div class="form-group">
              <p style="font-size: 12px; color: var(--color-text-light); background: rgba(37, 77, 50, 0.05); padding: 12px; border-radius: 6px; border-left: 3px solid var(--color-success);">
                🔒 <strong>Tu privacidad es importante:</strong> Todos tus datos están encriptados y solo tú tienes acceso a tu información financiera.
              </p>
            </div>
            
            <div class="form-error" id="register-error"></div>
            
            <button class="btn btn-primary full-width" onclick="register()">Crear Cuenta</button>
            
            <div class="auth-links">
              <p>¿Ya tienes cuenta? <a href="#" onclick="showLogin()">Inicia Sesión</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- App principal -->
    <div id="main-app" style="display: flex; width: 100%;">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="logo">NEXO</div>
        </div>
        
        <div class="sidebar-user">
          <div class="user-avatar">
            <span class="material-icons">account_circle</span>
          </div>
          <div class="user-info">
            <div class="user-name" id="user-business-name">Mi Negocio</div>
          </div>
        </div>
        
        <div class="security-badge">
          <span class="material-icons" style="font-size: 16px;">verified_user</span>
          <span>Datos seguros y encriptados</span>
        </div>
        
        <div class="sidebar-menu">
          <a href="#dashboard" class="menu-item active" data-page="dashboard">
            <span class="material-icons">dashboard</span>
            <span class="menu-text">Dashboard</span>
          </a>
          <a href="#transactions" class="menu-item" data-page="transactions">
            <span class="material-icons">receipt</span>
            <span class="menu-text">Transacciones</span>
          </a>
          <a href="#reports" class="menu-item" data-page="reports">
            <span class="material-icons">assessment</span>
            <span class="menu-text">Reportes</span>
          </a>
        </div>
        
        <div class="sidebar-footer">
          <a href="#" class="menu-item" onclick="logout()">
            <span class="material-icons">exit_to_app</span>
            <span class="menu-text">Cerrar Sesión</span>
          </a>
        </div>
      </div>
      
      <!-- Mobile header -->
      <div class="mobile-header">
        <button class="menu-toggle">
          <span class="material-icons">menu</span>
        </button>
        <div class="logo">NEXO</div>
        <div class="user-icon">
          <span class="material-icons">account_circle</span>
        </div>
      </div>
      
      <!-- Main content area -->
      <div class="main-content">
        <div id="page-container">
  <div id="transaction-filters"></div>
  <div id="transaction-filters"></div>
          <!-- Dashboard Page -->
          <div class="dashboard-container">
            <!-- Card de Bienvenida -->
            <div class="welcome-card">
              <div class="greeting" id="welcome-greeting">¡Hola! Bienvenido a tu nuevo dashboard financiero</div>
              <h2>Tu negocio está listo para crecer</h2>
              <p style="margin-bottom: 20px;">Nexo te ayudará a llevar el control total de tus finanzas. Registra tu primera transacción y ve cómo tus datos cobran vida en gráficos e insights personalizados.</p>
              
              <div class="setup-steps">
                <div class="setup-step">
                  <span class="material-icons">add_circle</span>
                  <h4>1. Primera Transacción</h4>
                  <p>Registra tu primer ingreso o gasto para empezar</p>
                </div>
                <div class="setup-step">
                  <span class="material-icons">category</span>
                  <h4>2. Categorías Smart</h4>
                  <p>Usa categorías adaptadas a tu industria</p>
                </div>
                <div class="setup-step">
                  <span class="material-icons">insights</span>
                  <h4>3. Insights Automáticos</h4>
                  <p>Recibe recomendaciones personalizadas</p>
                </div>
              </div>
            </div>

            <div class="dashboard-header">
              <div>
                <div class="greeting">Dashboard Financiero</div>
                <h1>Tu saldo actual</h1>
              </div>
              <button class="btn btn-primary" onclick="showTransactionModal()">
                <span class="material-icons">add</span>
                Registrar Transacción
              </button>
            </div>
            
            <!-- Summary Cards -->
            <div class="summary-cards">
              <div class="summary-card">
                <h3 class="card-title">Saldo Actual</h3>
                <p class="card-value">$0.00</p>
                <div class="card-indicator neutral">
                  <span class="material-icons">info</span>
                  <span>Listo para empezar</span>
                </div>
              </div>
              
              <div class="summary-card">
                <h3 class="card-title">Ingresos (este mes)</h3>
                <p class="card-value">$0.00</p>
                <div class="card-indicator neutral">
                  <span class="material-icons">trending_flat</span>
                  <span>Sin ingresos registrados</span>
                </div>
              </div>
              
              <div class="summary-card">
                <h3 class="card-title">Gastos (este mes)</h3>
                <p class="card-value">$0.00</p>
                <div class="card-indicator neutral">
                  <span class="material-icons">trending_flat</span>
                  <span>Sin gastos registrados</span>
                </div>
              </div>
            </div>

            <!-- Insights Cards -->
            <div class="insights-grid">
              <div class="insight-card">
                <div class="insight-content">
                  <span class="material-icons insight-icon">lightbulb</span>
                  <div class="insight-text">
                    Una vez que registres algunas transacciones, aquí verás insights personalizados para optimizar tus finanzas.
                  </div>
                </div>
              </div>
              <div class="insight-card success">
                <div class="insight-content">
                  <span class="material-icons insight-icon" style="color: var(--color-success);">trending_up</span>
                  <div class="insight-text">
                    Nexo analizará tus patrones de ingresos y gastos para darte recomendaciones accionables.
                  </div>
                </div>
              </div>
              <div class="insight-card warning">
                <div class="insight-content">
                  <span class="material-icons insight-icon" style="color: #fbbf24;">schedule</span>
                  <div class="insight-text">
                    <span class="insight-action">¡Empieza hoy!</span> Mientras más datos tengas, más precisos serán tus reportes.
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Gráficos -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 32px;">
              <!-- Tendencia ingresos vs gastos -->
              <div class="card">
                <div class="card-header">
                  <h2>Tendencia Ingresos vs Gastos</h2>
                  <select style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                    <option value="1">1 mes</option>
                    <option value="3">3 meses</option>
                    <option value="6" selected>6 meses</option>
                    <option value="12">12 meses</option>
                  </select>
                </div>
                <div class="card-content">
                  <div class="chart-container">
                    <canvas id="trend-chart"></canvas>
                  </div>
                </div>
              </div>

              <!-- Distribución de gastos -->
              <div class="card">
                <div class="card-header">
                  <h2>Distribución de Gastos</h2>
                  <select style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                    <option value="1">1 mes</option>
                    <option value="3">3 meses</option>
                    <option value="6" selected>6 meses</option>
                    <option value="12">1 año</option>
                  </select>
                </div>
                <div class="card-content">
                  <div class="chart-container">
                    <canvas id="expense-chart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Proyección de saldo -->
            <div class="card">
              <div class="card-header">
                <h2>Proyección Básica del Saldo Futuro</h2>
                <select style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                  <option value="1">1 mes</option>
                  <option value="3" selected>3 meses</option>
                  <option value="6">6 meses</option>
                  <option value="12">12 meses</option>
                </select>
              </div>
              <div class="card-content">
                <div class="chart-container">
                  <canvas id="projection-chart"></canvas>
                </div>
              </div>
            </div>

            <!-- WhatsApp Integration Card -->
            <div class="card whatsapp-card">
              <div class="card-header">
                <h2>🚀 Registra desde WhatsApp</h2>
              </div>
              <div class="card-content">
                <p style="margin-bottom: 20px;">Conecta tu WhatsApp y registra transacciones usando un flujo simple guiado. Solo escribe "1" para ingresos o "2" para gastos.</p>
                
                <div class="whatsapp-features">
                  <div class="whatsapp-feature">
                    <span class="material-icons">chat</span>
                    <h4>Flujo Guiado</h4>
                    <p>Nexo te guía paso a paso</p>
                  </div>
                  <div class="whatsapp-feature">
                    <span class="material-icons">flash_on</span>
                    <h4>Súper Simple</h4>
                    <p>Solo números: 1 o 2 para empezar</p>
                  </div>
                  <div class="whatsapp-feature">
                    <span class="material-icons">check_circle</span>
                    <h4>Confirmación Clara</h4>
                    <p>Recibe confirmación de cada registro</p>
                  </div>
                </div>

                <div style="margin-top: 24px; text-align: center;">
                  <button class="btn btn-secondary" onclick="showWhatsAppModal()" style="background: white; color: #25D366; font-weight: 600;">
                    <span class="material-icons">whatsapp</span>
                    Probar Demo WhatsApp
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Transaction Modal -->
  <div class="modal" id="transaction-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nueva Transacción</h2>
        <button class="close-btn" onclick="hideTransactionModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="transaction-form">
          <div class="form-group">
            <label>Tipo de Transacción</label>
            <div class="type-selector">
              <label class="type-option">
                <input type="radio" name="type" value="income" checked>
                <span class="type-label income">💰 Ingreso</span>
              </label>
              <label class="type-option">
                <input type="radio" name="type" value="expense">
                <span class="type-label expense">💸 Gasto</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="transaction-category">Categoría</label>
            <div class="input-with-icon">
              <span class="material-icons">category</span>
              <select id="transaction-category" required>
                <option value="">Selecciona una categoría</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="transaction-amount">Monto</label>
            <div class="input-with-icon">
              <span class="currency-symbol">$</span>
              <input type="number" id="transaction-amount" placeholder="0.00" step="0.01" min="0" required style="padding-left: 32px;">
            </div>
          </div>
          
          <div class="form-group">
            <label for="transaction-date">Fecha</label>
            <div class="input-with-icon">
              <span class="material-icons">event</span>
              <input type="date" id="transaction-date" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="transaction-description">Descripción (opcional)</label>
            <div class="input-with-icon">
              <span class="material-icons">notes</span>
              <textarea id="transaction-description" rows="3" style="padding-left: 44px; resize: vertical; border: 2px solid rgba(37, 77, 50, 0.2); border-radius: 8px; width: 100%; padding: 12px 12px 12px 44px;" placeholder="Detalles adicionales..."></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideTransactionModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveTransaction()">
          <span class="material-icons">save</span>
          Guardar Transacción
        </button>
      </div>
    </div>
  </div>

  <!-- WhatsApp Demo Modal -->
  <div class="modal" id="whatsapp-modal">
    <div class="modal-content" style="max-width: 450px;">
      <div class="modal-header">
        <h2>Demo WhatsApp con Nexo</h2>
        <button class="close-btn" onclick="hideWhatsAppModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body" style="padding: 0;">
        <div class="whatsapp-demo">
          <div class="whatsapp-header">
            <div class="whatsapp-avatar">N</div>
            <div>
              <div style="font-weight: bold;">Nexo Bot</div>
              <div style="font-size: 12px; opacity: 0.8;">en línea</div>
            </div>
          </div>
          
          <div class="whatsapp-messages" id="whatsapp-messages">
            <div class="message received">
              Hola! Soy Nexo, tu asistente para llevar las cuentas de tu negocio.
              <div class="message-time">14:30</div>
            </div>
            <div class="message received">
              Para registrar una transacción:<br>
              - Escribe 1 para un INGRESO (dinero que entra)<br>
              - Escribe 2 para un GASTO (dinero que sale)
              <div class="message-time">14:30</div>
            </div>
          </div>
          
          <div class="whatsapp-input">
            <input type="text" id="whatsapp-input" placeholder="Escribe un mensaje..." onkeypress="handleWhatsAppEnter(event)">
            <button onclick="sendWhatsAppMessage()">
              <span class="material-icons" style="font-size: 16px;">send</span>
            </button>
          </div>
        </div>
        
        <div style="background: var(--color-gray-light); border-radius: 8px; padding: 16px; margin: 20px;">
          <h4 style="margin-bottom: 12px; color: var(--color-primary);">Cómo usar:</h4>
          <div style="margin-bottom: 8px;">📝 <strong>Escribe "1"</strong> → Para registrar un ingreso</div>
          <div style="margin-bottom: 8px;">📝 <strong>Escribe "2"</strong> → Para registrar un gasto</div>
          <div>💰 <strong>Sigue las instrucciones</strong> → Monto y categoría</div>
        </div>
        
        <div style="padding: 16px; background: #f8f9fa; text-align: center;">
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">
            Esta es una simulación. En la versión real, conectarías tu WhatsApp real.
          </p>
          <button class="btn btn-success" style="background: #25D366; padding: 6px 12px; font-size: 12px;">
            <span class="material-icons" style="font-size: 14px;">whatsapp</span>
            Conectar WhatsApp Real
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Estado global de la aplicación
    let currentUser = null;
    let appData = {
      transactions: [],
      balance: 0,
      monthlyIncome: 0,
      monthlyExpenses: 0
    };
    let whatsappState = {
      step: 'start',
      type: null,
      amount: null
    };

    // Variables para gráficos
    let trendChart = null;
    let expenseChart = null;
    let projectionChart = null;

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      loadAppData();
      
      const savedUser = localStorage.getItem('nexo-user');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showMainApp();
      } else {
        showLogin();
      }
      
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('transaction-date');
      if (dateInput) {
        dateInput.value = today;
      }
      
      // Mobile menu toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      
      if (menuToggle) {
        menuToggle.addEventListener('click', function() {
          sidebar.classList.toggle('open');
        });
      }

      // Event listeners para tipo de transacción
      setTimeout(() => {
        const typeInputs = document.querySelectorAll('input[name="type"]');
        typeInputs.forEach(input => {
          input.addEventListener('change', updateCategories);
        });
      }, 100);
    });

    // Gestión de datos
    function loadAppData() {
      const savedData = localStorage.getItem('nexo-app-data');
      if (savedData) {
        appData = JSON.parse(savedData);
      }
      updateDashboard();
    }

    function saveAppData() {
      localStorage.setItem('nexo-app-data', JSON.stringify(appData));
    }

    function addTransaction(transaction) {
    // Se asegura que el gráfico se actualice
    updateCharts();
      transaction.id = Date.now() + Math.random();
      transaction.timestamp = new Date().toISOString();
      
      appData.transactions.push(transaction);
      calculateTotals();
      saveAppData();
      updateDashboard();
    }

    function calculateTotals() {
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      
      appData.balance = 0;
      appData.monthlyIncome = 0;
      appData.monthlyExpenses = 0;
      
      appData.transactions.forEach(transaction => {
        const transactionDate = new Date(transaction.date);
        const amount = parseFloat(transaction.amount);
        
        if (transaction.type === 'income') {
          appData.balance += amount;
          if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
            appData.monthlyIncome += amount;
          }
        } else {
          appData.balance -= amount;
          if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
            appData.monthlyExpenses += amount;
          }
        }
      });
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount);
    }

    function updateDashboard() {
      const balanceElement = document.querySelector('.summary-card:nth-child(1) .card-value');
      const incomeElement = document.querySelector('.summary-card:nth-child(2) .card-value');
      const expenseElement = document.querySelector('.summary-card:nth-child(3) .card-value');
      
      if (balanceElement) balanceElement.textContent = formatCurrency(appData.balance);
      if (incomeElement) incomeElement.textContent = formatCurrency(appData.monthlyIncome);
      if (expenseElement) expenseElement.textContent = formatCurrency(appData.monthlyExpenses);
      
      updateIndicators();
      updateCharts();
    }

    function updateIndicators() {
      const balanceIndicator = document.querySelector('.summary-card:nth-child(1) .card-indicator');
      const incomeIndicator = document.querySelector('.summary-card:nth-child(2) .card-indicator');
      const expenseIndicator = document.querySelector('.summary-card:nth-child(3) .card-indicator');
      
      if (balanceIndicator) {
        if (appData.balance > 0) {
          balanceIndicator.className = 'card-indicator positive';
          balanceIndicator.innerHTML = '<span class="material-icons">trending_up</span><span>Saldo positivo</span>';
        } else if (appData.balance < 0) {
          balanceIndicator.className = 'card-indicator negative';
          balanceIndicator.innerHTML = '<span class="material-icons">trending_down</span><span>Saldo negativo</span>';
        } else {
          balanceIndicator.className = 'card-indicator neutral';
          balanceIndicator.innerHTML = '<span class="material-icons">info</span><span>Listo para empezar</span>';
        }
      }
      
      if (incomeIndicator && appData.monthlyIncome > 0) {
        const incomeCount = appData.transactions.filter(t => t.type === 'income' && isCurrentMonth(t.date)).length;
        incomeIndicator.className = 'card-indicator positive';
        incomeIndicator.innerHTML = '<span class="material-icons">trending_up</span><span>' + incomeCount + ' transacciones</span>';
      }
      
      if (expenseIndicator && appData.monthlyExpenses > 0) {
        const expenseCount = appData.transactions.filter(t => t.type === 'expense' && isCurrentMonth(t.date)).length;
        expenseIndicator.className = 'card-indicator negative';
        expenseIndicator.innerHTML = '<span class="material-icons">trending_down</span><span>' + expenseCount + ' transacciones</span>';
      }
    }

    function updateCharts() {
      if (appData.transactions.length === 0) {
        showEmptyCharts();
        return;
      }
      
      updateTrendChart();
      updateExpenseChart();
      updateProjectionChart();
    }

    function showEmptyCharts() {
      const containers = ['trend-chart', 'expense-chart', 'projection-chart'];
      containers.forEach(id => {
        const canvas = document.getElementById(id);
        if (canvas) {
          const container = canvas.parentElement;
          container.innerHTML = `
            <div class="empty-state">
              <span class="material-icons">show_chart</span>
              <h3>Gráfico disponible con datos</h3>
              <p>Registra algunas transacciones para ver tus gráficos financieros</p>
            </div>
          `;
        }
      });
    }

    function updateTrendChart() {
      const canvas = document.getElementById('trend-chart');
      if (!canvas) return;
      
      const months = [];
      const incomes = [];
      const expenses = [];
      const profits = [];
      
      for (let i = 5; i >= 0; i--) {
        const date = new Date();
        date.setMonth(date.getMonth() - i);
        const monthKey = date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0');
        
        months.push(date.toLocaleDateString('es-ES', { month: 'short', year: '2-digit' }));
        
        const monthTransactions = appData.transactions.filter(t => {
          const tDate = new Date(t.date);
          return (tDate.getFullYear() + '-' + String(tDate.getMonth() + 1).padStart(2, '0')) === monthKey;
        });
        
        const monthIncome = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + parseFloat(t.amount), 0);
        const monthExpense = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + parseFloat(t.amount), 0);
        
        incomes.push(monthIncome);
        expenses.push(monthExpense);
        profits.push(monthIncome - monthExpense);
      }
      
      if (trendChart) {
        trendChart.destroy();
      }
      
      trendChart = new Chart(canvas, {
        type: 'line',
        data: {
          labels: months,
          datasets: [{
            label: 'Ingresos',
            data: incomes,
            borderColor: '#4CAF50',
            backgroundColor: 'rgba(76, 175, 80, 0.1)',
            tension: 0.4
          }, {
            label: 'Gastos',
            data: expenses,
            borderColor: '#E57373',
            backgroundColor: 'rgba(229, 115, 115, 0.1)',
            tension: 0.4
          }, {
            label: 'Beneficio',
            data: profits,
            borderColor: '#2196F3',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '$' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
    }

    function updateExpenseChart() {
      const canvas = document.getElementById('expense-chart');
      if (!canvas) return;
      
      const expensesByCategory = {};
      appData.transactions.filter(t => t.type === 'expense').forEach(t => {
        const category = t.categoryText || t.category;
        expensesByCategory[category] = (expensesByCategory[category] || 0) + parseFloat(t.amount);
      });
      
      const sortedCategories = Object.entries(expensesByCategory)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 5);
      
      if (sortedCategories.length === 0) return;
      
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      const colors = ['#E57373', '#FF8A65', '#FFB74D', '#81C784', '#64B5F6'];
      
      expenseChart = new Chart(canvas, {
        type: 'doughnut',
        data: {
          labels: sortedCategories.map(([category]) => category),
          datasets: [{
            data: sortedCategories.map(([, amount]) => amount),
            backgroundColor: colors.slice(0, sortedCategories.length),
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    function updateProjectionChart() {
      const canvas = document.getElementById('projection-chart');
      if (!canvas) return;
      
      const months = [];
      const actualData = [];
      const projectedData = [];
      
      // Últimos 3 meses reales
      for (let i = 2; i >= 0; i--) {
        const date = new Date();
        date.setMonth(date.getMonth() - i);
        months.push(date.toLocaleDateString('es-ES', { month: 'short' }));
        
        const monthTransactions = appData.transactions.filter(t => {
          const tDate = new Date(t.date);
          return tDate.getMonth() === date.getMonth() && tDate.getFullYear() === date.getFullYear();
        });
        
        const balance = monthTransactions.reduce((sum, t) => {
          return sum + (t.type === 'income' ? parseFloat(t.amount) : -parseFloat(t.amount));
        }, 0);
        
        actualData.push(balance);
        projectedData.push(null);
      }
      
      // Próximos 3 meses proyectados
      const avgMonthlyChange = actualData.length > 1 ? 
        (actualData[actualData.length - 1] - actualData[0]) / (actualData.length - 1) : 0;
      
      for (let i = 1; i <= 3; i++) {
        const date = new Date();
        date.setMonth(date.getMonth() + i);
        months.push(date.toLocaleDateString('es-ES', { month: 'short' }));
        
        actualData.push(null);
        projectedData.push(appData.balance + (avgMonthlyChange * i));
      }
      
      if (projectionChart) {
        projectionChart.destroy();
      }
      
      projectionChart = new Chart(canvas, {
        type: 'line',
        data: {
          labels: months,
          datasets: [{
            label: 'Saldo Real',
            data: actualData,
            borderColor: '#2196F3',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            tension: 0.4,
            borderWidth: 3
          }, {
            label: 'Proyección',
            data: projectedData,
            borderColor: '#2196F3',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            borderDash: [5, 5],
            tension: 0.4,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: false }
          },
          scales: {
            y: {
              ticks: {
                callback: function(value) {
                  return '$' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
    }

    function isCurrentMonth(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
    }

    // Autenticación
    function showLogin() {
      document.getElementById('login-page').style.display = 'block';
      document.getElementById('register-page').style.display = 'none';
      document.getElementById('main-app').style.display = 'none';
    }

    function showRegister() {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('register-page').style.display = 'block';
      document.getElementById('main-app').style.display = 'none';
    }

    function showMainApp() {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('register-page').style.display = 'none';
      document.getElementById('main-app').style.display = 'flex';
      
      if (currentUser) {
        document.getElementById('user-business-name').textContent = currentUser.businessName || 'Mi Negocio';
        const greetingElement = document.getElementById('welcome-greeting');
        if (greetingElement) {
          greetingElement.textContent = '¡Hola ' + currentUser.businessName + '! Bienvenido a tu dashboard financiero';
        }
        
        if (currentUser.role === 'admin') {
          updateSidebarForAdmin();
          showAdminDashboard();
        }
      }
    }

    function login() {
      const phone = document.getElementById('login-phone').value;
      const password = document.getElementById('login-password').value;
      
      if (phone === 'demo' && password === 'demo') {
        currentUser = {
          businessName: 'Cafetería Demo',
          industry: 'restaurant',
          phone: '+507 1234-5678',
          type: 'business',
          role: 'user'
        };
        localStorage.setItem('nexo-user', JSON.stringify(currentUser));
        showMainApp();
      } else if (phone === 'admin' && password === 'admin') {
        currentUser = {
          businessName: 'Nexo Admin',
          industry: 'administration',
          phone: '+507 9999-9999',
          type: 'business',
          role: 'admin'
        };
        localStorage.setItem('nexo-user', JSON.stringify(currentUser));
        showMainApp();
      } else {
        const errorElement = document.getElementById('login-error');
        errorElement.style.display = 'block';
        errorElement.textContent = 'Credenciales incorrectas. Usa "demo"/"demo" o "admin"/"admin"';
      }
    }

    function register() {
      const businessName = document.getElementById('register-business').value;
      const industry = document.getElementById('register-industry').value;
      const phone = document.getElementById('register-phone').value;
      const password = document.getElementById('register-password').value;
      const type = document.getElementById('register-type').value;

      if (!businessName || !industry || !phone || !password) {
        const errorElement = document.getElementById('register-error');
        errorElement.style.display = 'block';
        errorElement.textContent = 'Por favor completa todos los campos';
        return;
      }

      currentUser = {
        businessName,
        industry,
        phone,
        type,
        role: 'user'
      };
      
      localStorage.setItem('nexo-user', JSON.stringify(currentUser));
        showMainApp();
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('nexo-user');
        window.location.reload();
      showLogin();
    }

    // Categorías dinámicas
    function updateCategories() {
      const typeRadio = document.querySelector('input[name="type"]:checked');
      if (!typeRadio) return;
      
      const type = typeRadio.value;
      const categorySelect = document.getElementById('transaction-category');
      if (!categorySelect) return;
      
      const industryCategories = {
        retail: {
          income: ['Ventas', 'Productos', 'Servicios', 'Otros ingresos'],
          expense: ['Inventario', 'Alquiler', 'Servicios públicos', 'Marketing', 'Otros gastos']
        },
        professional: {
          income: ['Consultoría', 'Servicios profesionales', 'Honorarios', 'Otros ingresos'],
          expense: ['Oficina', 'Herramientas', 'Capacitación', 'Marketing', 'Otros gastos']
        },
        restaurant: {
          income: ['Ventas', 'Servicio a domicilio', 'Eventos', 'Otros ingresos'],
          expense: ['Ingredientes', 'Alquiler', 'Servicios públicos', 'Equipos', 'Otros gastos']
        },
        technical: {
          income: ['Reparaciones', 'Mantenimiento', 'Instalaciones', 'Otros ingresos'],
          expense: ['Herramientas', 'Repuestos', 'Transporte', 'Equipos', 'Otros gastos']
        },
        'direct-sales': {
          income: ['Ventas directas', 'Comisiones', 'Bonos', 'Otros ingresos'],
          expense: ['Productos', 'Transporte', 'Marketing', 'Comunicaciones', 'Otros gastos']
        }
      };
      
      const userIndustry = currentUser?.industry || 'retail';
      const categories = industryCategories[userIndustry] || industryCategories.retail;
      
      if (type === 'income') {
        categorySelect.innerHTML = '<option value="">Selecciona una categoría</option>' +
          categories.income.map(cat => '<option value="' + cat.toLowerCase().replace(/\s+/g, '-') + '">' + cat + '</option>').join('');
      } else {
        categorySelect.innerHTML = '<option value="">Selecciona una categoría</option>' +
          categories.expense.map(cat => '<option value="' + cat.toLowerCase().replace(/\s+/g, '-') + '">' + cat + '</option>').join('');
      }
    }

    

function applyTransactionFilters() {
  const type = document.getElementById('filter-type').value;
  const category = document.getElementById('filter-category').value;

  const filtered = appData.transactions.filter(t => {
    return (!type || t.type === type) && (!category || t.category === category || t.categoryText === category);
  });

  renderTransactionTable(filtered);

}

function resetTransactionFilters() {
  document.getElementById('filter-type').value = '';
  document.getElementById('filter-category').value = '';
  renderTransactionTable(appData.transactions);
}

// Extraemos categorías únicas para alimentar el select de categoría
function populateCategoryFilter() {
  const categorySelect = document.getElementById('filter-category');
  const categories = [...new Set(appData.transactions.map(t => t.category))];
  categorySelect.innerHTML = '<option value="">Categoría: Todas</option>' +
    categories.map(cat => '<option value="' + cat + '">' + cat + '</option>').join('');
}

function renderTransactionTable(data) {
  const sortedTransactions = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));
  let html = '<div class="transactions-table">';
  html += '<div class="table-header"><div>Tipo</div><div>Categoría</div><div>Monto</div><div>Fecha</div><div>Fuente</div></div>';
  sortedTransactions.forEach(t => {
    html += '<div class="transaction-row">' +
      '<div>' + (t.type === 'income' ? 'Ingreso' : 'Gasto') + '</div>' +
      '<div>' + t.categoryText + '</div>' +
      '<div>' + formatCurrency(t.amount) + '</div>' +
      '<div>' + t.date + '</div>' +
      '<div><span class="source-badge" style="background: ' + (t.source === 'whatsapp' ? '#25D366' : '#254D32') + ';">' + t.source + '</span></div>' +
      '</div>';
  });
  html += '</div>';

  const container = document.querySelector('.transactions-table');
  if (container) {
    container.outerHTML = html;
  }
  populateCategoryFilter();
}


// Modal de transacciones
    function showTransactionModal() {
      document.getElementById('transaction-modal').classList.add('show');
      setTimeout(updateCategories, 100);
    }

    function hideTransactionModal() {
      document.getElementById('transaction-modal').classList.remove('show');
      const form = document.getElementById('transaction-form');
      if (form) form.reset();
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('transaction-date');
      if (dateInput) dateInput.value = today;
      const incomeRadio = document.querySelector('input[name="type"][value="income"]');
      if (incomeRadio) incomeRadio.checked = true;
      setTimeout(updateCategories, 100);
    }

    function saveTransaction() {
      const form = document.getElementById('transaction-form');
      
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      const typeRadio = document.querySelector('input[name="type"]:checked');
      const type = typeRadio ? typeRadio.value : 'income';
      const amount = parseFloat(document.getElementById('transaction-amount').value);
      const categorySelect = document.getElementById('transaction-category');
      const categoryText = categorySelect.selectedOptions[0].text;
      const categoryValue = categorySelect.value;
      const date = document.getElementById('transaction-date').value;
      const description = document.getElementById('transaction-description').value;
      
      const transaction = {
        type: type,
        amount: amount,
        category: categoryValue,
        categoryText: categoryText,
        date: date,
        description: description || (categoryText + ' - ' + (type === 'income' ? 'Ingreso' : 'Gasto')),
        source: 'web'
      };
      
      addTransaction(transaction);
      
      const icon = type === 'income' ? '✅' : '💸';
      const typeText = type === 'income' ? 'ingreso' : 'gasto';
      
      alert(icon + ' ¡Listo! Se registró un ' + typeText + ' de $' + amount + ' en la categoría \'' + categoryText + '\'. ¿Deseas registrar otra transacción?');
      
      hideTransactionModal();
    }

    // WhatsApp Demo
    function showWhatsAppModal() {
      document.getElementById('whatsapp-modal').classList.add('show');
      
      whatsappState = {
        step: 'start',
        type: null,
        amount: null
      };
      
      const messagesContainer = document.getElementById('whatsapp-messages');
      if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
    }

    function hideWhatsAppModal() {
      document.getElementById('whatsapp-modal').classList.remove('show');
    }

    function handleWhatsAppEnter(event) {
      if (event.key === 'Enter') {
        sendWhatsAppMessage();
      }
    }

    function sendWhatsAppMessage() {
      const input = document.getElementById('whatsapp-input');
      const message = input.value.trim();
      
      if (!message) return;
      
      addWhatsAppMessage(message, 'sent');
      input.value = '';
      
      setTimeout(() => {
        const response = generateBotResponse(message);
        addWhatsAppMessage(response, 'received');
      }, 1000);
    }

    function addWhatsAppMessage(text, type) {
      const messagesContainer = document.getElementById('whatsapp-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message ' + type;
      
      const now = new Date();
      const time = now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0');
      
      messageDiv.innerHTML = text + '<div class="message-time">' + time + '</div>';
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function generateBotResponse(userMessage) {
      const message = userMessage.trim();
      
      if (whatsappState.step === 'start') {
        if (message === '1') {
          whatsappState.step = 'waiting_amount';
          whatsappState.type = 'income';
          return "Perfecto! Vamos a registrar un ingreso.<br>¿Cuál fue el monto en B/.?";
        } else if (message === '2') {
          whatsappState.step = 'waiting_amount';
          whatsappState.type = 'expense';
          return "Entendido! Vamos a registrar un gasto.<br>¿Cuál fue el monto en B/.?";
        } else {
          return "No entendí ese mensaje.<br>Escribe 1 para ingreso o 2 para gasto";
        }
      }
      
      if (whatsappState.step === 'waiting_amount') {
        const amount = parseFloat(message);
        if (isNaN(amount) || amount <= 0) {
          return "Por favor envía solo el número del monto.<br>Ejemplo: 25 o 25.50";
        }
        
        whatsappState.amount = amount;
        whatsappState.step = 'waiting_category';
        
        if (whatsappState.type === 'income') {
          return 'Excelente! Para tus B/. ' + amount + ', ¿cómo entró este dinero?<br>1. Venta de Comidas y Bebidas en Local<br>2. Pedidos a Domicilio (Delivery)<br>3. Otros Ingresos del Restaurante';
        } else {
          return 'Gracias! Para tus B/. ' + amount + ', ¿en qué se usó este dinero?<br>1. Ingredientes y Alimentos<br>2. Salarios de Personal<br>3. Alquiler del Local<br>4. Servicios Básicos<br>5. Otros Gastos Operativos';
        }
      }
      
      if (whatsappState.step === 'waiting_category') {
        let category = '';
        
        if (message === '1') {
          category = whatsappState.type === 'income' ? 'Venta de Comidas y Bebidas en Local' : 'Ingredientes y Alimentos';
        } else if (message === '2') {
          category = whatsappState.type === 'income' ? 'Pedidos a Domicilio (Delivery)' : 'Salarios de Personal';
        } else if (message === '3') {
          category = 'Alquiler del Local';
        } else if (message === '4') {
          category = 'Servicios Básicos (Gas, Luz, Agua)';
        } else if (message === '5') {
          category = 'Otros Gastos Operativos (Ej. Mantenimiento, Suministros)';
        } else {
          return "Selecciona una opción del 1 al 3";
        }
        
        // Crear y guardar transacción
        const transaction = {
          type: whatsappState.type,
          amount: whatsappState.amount,
          category: category.toLowerCase().replace(/\s+/g, '-'),
          categoryText: category,
          date: new Date().toISOString().split('T')[0],
          description: category + ' - ' + (whatsappState.type === 'income' ? 'Ingreso' : 'Gasto') + ' vía WhatsApp',
          source: 'whatsapp'
        };
        
        addTransaction(transaction);
        
        const response = 'Listo! Registré B/. ' + whatsappState.amount + ' en ' + category + '.<br><br>¿Otro registro?<br>- 1 para INGRESO<br>- 2 para GASTO';
        
        whatsappState = {
          step: 'start',
          type: null,
          amount: null
        };
        
        return response;
      }
      
      return "No entendí ese mensaje.<br>Escribe 1 para ingreso o 2 para gasto";
    }

    function generateTransactionsList() {
      if (appData.transactions.length === 0) {
        return '<div class="empty-state"><span class="material-icons">receipt_long</span><h3>No hay transacciones registradas</h3><p>Aquí verás una lista con tipo, categoría, monto y fecha. Los ingresos aparecerán en verde y los gastos en rojo. Las transacciones vía WhatsApp tendrán una etiqueta especial.</p><button class="btn btn-primary" onclick="showTransactionModal()"><span class="material-icons">add</span>Registrar Primera Transacción</button></div>';
      }
      
      const sortedTransactions = [...appData.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      document.getElementById('transaction-filters').innerHTML = `
<div class="card" style="margin-bottom: 24px;">
  <div class="card-header">
    <h2>Filtrar Transacciones</h2>
  </div>
  <div class="card-content" style="display: flex; flex-wrap: wrap; gap: 16px; padding: 16px;">
    <select id="filter-type" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
      <option value="">Tipo: Todos</option>
      <option value="income">Ingreso</option>
      <option value="expense">Gasto</option>
    </select>
    <select id="filter-category" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
      <option value="">Categoría: Todas</option>
    </select>
    <button class="btn btn-secondary" onclick="applyTransactionFilters()">Aplicar Filtros</button>
    <button class="btn btn-danger" onclick="resetTransactionFilters()">Limpiar</button>
  </div>
</div>
`;

      let html = '<div class="transactions-table">';
      html += '<div class="table-header"><div>Tipo</div><div>Categoría</div><div>Monto</div><div>Fecha</div><div>Fuente</div></div>';
      
      sortedTransactions.forEach(transaction => {
        const isIncome = transaction.type === 'income';
        const color = isIncome ? 'var(--color-success)' : 'var(--color-danger)';
        const icon = isIncome ? 'trending_up' : 'trending_down';
        const typeText = isIncome ? 'Ingreso' : 'Gasto';
        const amountPrefix = isIncome ? '+' : '-';
        const sourceColor = transaction.source === 'whatsapp' ? '#25D366' : 'var(--color-primary)';
        const sourceText = transaction.source === 'whatsapp' ? 'WhatsApp' : 'Web';
        
        html += '<div class="transaction-row">';
        html += '<div style="display: flex; align-items: center; gap: 8px;"><span class="material-icons" style="color: ' + color + ';">' + icon + '</span><span style="color: ' + color + '; font-weight: 600;">' + typeText + '</span></div>';
        html += '<div>' + transaction.categoryText + '</div>';
        html += '<div style="font-weight: 600; color: ' + color + ';">' + amountPrefix + formatCurrency(transaction.amount) + '</div>';
        html += '<div>' + new Date(transaction.date).toLocaleDateString('es-ES') + '</div>';
        html += '<div><span class="source-badge" style="background: ' + sourceColor + '; color: white;">' + sourceText + '</span></div>';
        html += '</div>';
      });
      
      html += '</div>';
      return html;
    }

    // Admin functions
    function updateSidebarForAdmin() {
      const sidebarMenu = document.querySelector('.sidebar-menu');
      sidebarMenu.innerHTML = `
        <a href="#admin-dashboard" class="menu-item active" data-page="admin-dashboard">
          <span class="material-icons">admin_panel_settings</span>
          <span class="menu-text">Dashboard Admin</span>
        </a>
        <a href="#analytics" class="menu-item" data-page="analytics">
          <span class="material-icons">analytics</span>
          <span class="menu-text">Inteligencia de Datos</span>
        </a>
        <a href="#users" class="menu-item" data-page="users">
          <span class="material-icons">people</span>
          <span class="menu-text">Usuarios</span>
        </a>
        <a href="#reports" class="menu-item" data-page="admin-reports">
          <span class="material-icons">assessment</span>
          <span class="menu-text">Reportes</span>
        </a>
      `;
      
      // Re-attach event listeners
      document.querySelectorAll('.menu-item[data-page]').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          
          document.querySelectorAll('.menu-item').forEach(mi => mi.classList.remove('active'));
          this.classList.add('active');
          
          const page = this.dataset.page;
          
          if (page === 'admin-dashboard') {
            showAdminDashboard();
          } else if (page === 'analytics') {
            showAnalyticsDashboard();
          } else if (page === 'users') {
            showUsersPage();
          } else if (page === 'admin-reports') {
            showAdminReportsPage();
          }
        });
      });
    }

    function showAdminDashboard() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Panel de Administración</div>
              <h1>Dashboard de Datos</h1>
            </div>
          </div>
          
          <div class="summary-cards">
            <div class="summary-card">
              <h3 class="card-title">Total Usuarios</h3>
              <p class="card-value">1,247</p>
              <div class="card-indicator positive">
                <span class="material-icons">trending_up</span>
                <span>89 nuevos este mes</span>
              </div>
            </div>
            
            <div class="summary-card">
              <h3 class="card-title">Usuarios Activos</h3>
              <p class="card-value">1,098</p>
              <div class="card-indicator positive">
                <span class="material-icons">people</span>
                <span>88.1% del total</span>
              </div>
            </div>
            
            <div class="summary-card">
              <h3 class="card-title">Transacciones Totales</h3>
              <p class="card-value">15,623</p>
              <div class="card-indicator positive">
                <span class="material-icons">receipt</span>
                <span>12.5 por usuario</span>
              </div>
            </div>
            
            <div class="summary-card">
              <h3 class="card-title">Volumen Total</h3>
              <p class="card-value">$2.8M</p>
              <div class="card-indicator positive">
                <span class="material-icons">attach_money</span>
                <span>$2,285 promedio</span>
              </div>
            </div>
          </div>

          <div class="insights-grid">
            <div class="insight-card warning">
              <div class="insight-content">
                <span class="material-icons insight-icon" style="color: #fbbf24;">warning</span>
                <div class="insight-text">
                  <span class="insight-action">Alerta:</span> Incremento del 35% en transacciones del sector restaurantes en las últimas 48 horas.
                </div>
              </div>
            </div>
            <div class="insight-card success">
              <div class="insight-content">
                <span class="material-icons insight-icon" style="color: var(--color-success);">trending_up</span>
                <div class="insight-text">
                  <span class="insight-action">Tendencia positiva:</span> Uso de WhatsApp aumentó 28% comparado con el mes anterior.
                </div>
              </div>
            </div>
            <div class="insight-card">
              <div class="insight-content">
                <span class="material-icons insight-icon">schedule</span>
                <div class="insight-text">
                  <span class="insight-action">Horario pico:</span> Mayor actividad registrada entre 10:00-12:00 y 18:00-20:00.
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Distribución por Industria</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px; text-align: center;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 8px;">423</div>
                  <div>Restaurantes</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px; text-align: center;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 8px;">318</div>
                  <div>Comercio</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px; text-align: center;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 8px;">256</div>
                  <div>Servicios</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px; text-align: center;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 8px;">178</div>
                  <div>Técnicos</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px; text-align: center;">
                  <div style="font-size: 24px; font-weight: 700; color: var(--color-primary); margin-bottom: 8px;">72</div>
                  <div>Venta Directa</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Métricas de Retención</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
                <div style="text-align: center; padding: 20px; background: var(--color-gray-light); border-radius: 12px;">
                  <div style="font-size: 32px; font-weight: 700; color: var(--color-success); margin-bottom: 8px;">89%</div>
                  <div style="font-weight: 600;">Retención Día 1</div>
                </div>
                <div style="text-align: center; padding: 20px; background: var(--color-gray-light); border-radius: 12px;">
                  <div style="font-size: 32px; font-weight: 700; color: var(--color-info); margin-bottom: 8px;">67%</div>
                  <div style="font-weight: 600;">Retención Día 7</div>
                </div>
                <div style="text-align: center; padding: 20px; background: var(--color-gray-light); border-radius: 12px;">
                  <div style="font-size: 32px; font-weight: 700; color: var(--color-danger); margin-bottom: 8px;">45%</div>
                  <div style="font-weight: 600;">Retención Día 30</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>WhatsApp vs Web</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div style="text-align: center; padding: 20px; background: #25D366; color: white; border-radius: 12px;">
                  <div style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">8,923</div>
                  <div style="font-weight: 600;">Transacciones WhatsApp</div>
                </div>
                <div style="text-align: center; padding: 20px; background: var(--color-primary); color: white; border-radius: 12px;">
                  <div style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">6,700</div>
                  <div style="font-weight: 600;">Transacciones Web</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showAnalyticsDashboard() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Inteligencia de Datos</div>
              <h1>Panel de Análisis Avanzado</h1>
            </div>
          </div>
          
          <div class="insights-grid">
            <div class="insight-card warning">
              <div class="insight-content">
                <span class="material-icons insight-icon" style="color: #fbbf24;">warning</span>
                <div class="insight-text">
                  <span class="insight-action">Alerta:</span> Incremento del 35% en transacciones del sector restaurantes en las últimas 48 horas.
                </div>
              </div>
            </div>
            <div class="insight-card success">
              <div class="insight-content">
                <span class="material-icons insight-icon" style="color: var(--color-success);">trending_up</span>
                <div class="insight-text">
                  <span class="insight-action">Tendencia positiva:</span> Uso de WhatsApp aumentó 28% comparado con el mes anterior.
                </div>
              </div>
            </div>
            <div class="insight-card">
              <div class="insight-content">
                <span class="material-icons insight-icon">schedule</span>
                <div class="insight-text">
                  <span class="insight-action">Horario pico:</span> Mayor actividad registrada entre 10:00-12:00 y 18:00-20:00.
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Categorías Más Frecuentes por Industria</h2>
            </div>
            <div class="card-content">
              <div style="font-size: 14px; color: var(--color-text-light);">
                <div style="margin-bottom: 12px;"><strong>Restaurantes:</strong> Ingredientes (45%), Alquiler (22%), Equipos (18%)</div>
                <div style="margin-bottom: 12px;"><strong>Comercio:</strong> Inventario (52%), Marketing (19%), Alquiler (15%)</div>
                <div style="margin-bottom: 12px;"><strong>Servicios:</strong> Herramientas (38%), Oficina (28%), Capacitación (21%)</div>
                <div><strong>Técnicos:</strong> Repuestos (41%), Herramientas (35%), Transporte (14%)</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Promedios por Industria</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">
                <div><strong>Ingreso Mensual Promedio:</strong></div>
                <div>$2,847</div>
                <div><strong>Gasto Promedio:</strong></div>
                <div>$1,923</div>
                <div><strong>Margen Beneficio:</strong></div>
                <div style="color: var(--color-success);">32.4%</div>
                <div><strong>Saldo Promedio:</strong></div>
                <div>$924</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Análisis de Actividad por Tamaño de Negocio</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px;">
                  <h4 style="margin-bottom: 8px; color: var(--color-primary);">Micro (1-5 transacciones/mes)</h4>
                  <div>423 usuarios (34%)</div>
                  <div style="font-size: 12px; color: var(--color-text-light);">Promedio: $284/mes</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px;">
                  <h4 style="margin-bottom: 8px; color: var(--color-primary);">Pequeño (6-25 transacciones/mes)</h4>
                  <div>624 usuarios (50%)</div>
                  <div style="font-size: 12px; color: var(--color-text-light);">Promedio: $1,247/mes</div>
                </div>
                <div style="padding: 16px; background: var(--color-gray-light); border-radius: 8px;">
                  <h4 style="margin-bottom: 8px; color: var(--color-primary);">Mediano (25+ transacciones/mes)</h4>
                  <div>200 usuarios (16%)</div>
                  <div style="font-size: 12px; color: var(--color-text-light);">Promedio: $4,892/mes</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showUsersPage() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Gestión de Usuarios</div>
              <h1>Base de Usuarios</h1>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div class="empty-state">
                <span class="material-icons">people</span>
                <h3>Panel de Usuarios</h3>
                <p>Funcionalidad de gestión de usuarios disponible próximamente</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showAdminReportsPage() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Reportes Administrativos</div>
              <h1>Generación de Reportes</h1>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div class="empty-state">
                <span class="material-icons">assessment</span>
                <h3>Generador de Reportes</h3>
                <p>Sistema de reportes administrativos disponible próximamente</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Navegación
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal')) {
        hideTransactionModal();
        hideWhatsAppModal();
      }
      
      if (e.target.closest('.menu-item[data-page]')) {
        const item = e.target.closest('.menu-item[data-page]');
        e.preventDefault();
        
        document.querySelectorAll('.menu-item').forEach(mi => mi.classList.remove('active'));
        item.classList.add('active');
        
        const page = item.dataset.page;
        
        if (page === 'transactions') {
          showTransactionsPage();
        } else if (page === 'reports') {
          showReportsPage();
        } else if (page === 'dashboard') {
          showDashboardPage();
        }
      }
    });

    function showTransactionsPage() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Gestión de Transacciones</div>
              <h1>Historial Completo</h1>
            </div>
            <button class="btn btn-primary" onclick="showTransactionModal()">
              <span class="material-icons">add</span>
              Nueva Transacción
            </button>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2>Filtros Básicos</h2>
            </div>
            <div class="card-content">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                <select style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                  <option value="">Todos los tipos</option>
                  <option value="income">Solo ingresos</option>
                  <option value="expense">Solo gastos</option>
                </select>
                <input type="date" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                <input type="date" style="padding: 8px; border-radius: 6px; border: 1px solid rgba(37, 77, 50, 0.2);">
                <button class="btn btn-secondary">Filtrar</button>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div id="transactions-list">
                ${generateTransactionsList()}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showReportsPage() {
      const container = document.getElementById('page-container');
      container.innerHTML = `
        <div class="dashboard-container">
          <div class="dashboard-header">
            <div>
              <div class="greeting">Reportes Financieros</div>
              <h1>Estado de Resultados</h1>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="btn btn-secondary">
                <span class="material-icons">picture_as_pdf</span>
                Exportar PDF
              </button>
              <button class="btn btn-secondary">
                <span class="material-icons">table_view</span>
                Exportar Excel
              </button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2>Seleccionar Período</h2>
            </div>
            <div class="card-content">
              <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                <button class="btn btn-primary">Este Mes</button>
                <button class="btn btn-secondary">Este Trimestre</button>
                <button class="btn btn-secondary">Este Año</button>
                <button class="btn btn-secondary">Personalizado</button>
              </div>
            </div>
          </div>
          
          <div class="summary-cards">
            <div class="summary-card">
              <h3 class="card-title">Ingresos Totales</h3>
              <p class="card-value" style="color: var(--color-success);">${formatCurrency(appData.monthlyIncome)}</p>
            </div>
            <div class="summary-card">
              <h3 class="card-title">Gastos Totales</h3>
              <p class="card-value" style="color: var(--color-danger);">${formatCurrency(appData.monthlyExpenses)}</p>
            </div>
            <div class="summary-card">
              <h3 class="card-title">Utilidad Neta</h3>
              <p class="card-value">${formatCurrency(appData.monthlyIncome - appData.monthlyExpenses)}</p>
            </div>
          </div>
          
          <div class="card">
            <div class="card-content">
              <div class="empty-state">
                <span class="material-icons">assessment</span>
                <h3>Reporte tipo Income Statement disponible pronto</h3>
                <p>Informe mensual con comparativos de períodos anteriores, gráficos integrados y vista previa antes de descargar.</p>
                <button class="btn btn-primary" onclick="showTransactionModal()">
                  <span class="material-icons">add</span>
                  Registrar Primera Transacción
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showDashboardPage() {
      location.reload();
    }
  </script>
</body>
</html>